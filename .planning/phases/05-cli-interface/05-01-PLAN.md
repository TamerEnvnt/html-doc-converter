---
phase: 05-cli-interface
plan: 01
type: execute
---

<objective>
Create user-friendly command-line interface for the HTML document converter.

Purpose: Provide a simple CLI that users can invoke to convert HTML files to PDF or DOCX.
Output: Working CLI with argument parsing, help text, and format selection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Depends on:** Phase 3 (PDF Converter), Phase 4 (DOCX Converter)

**Tech available:**
- commander (installed in Phase 1) — CLI argument parsing

**CLI requirements (from PROJECT.md):**
- Single-file conversion (no batch for v1)
- Output format selection (pdf, docx, or both)
- Offline operation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement CLI argument parsing</name>
  <files>src/cli.ts</files>
  <action>
    Create CLI with commander:

    ```typescript
    #!/usr/bin/env node
    import { Command } from 'commander';
    import { convertToPDF, closeBrowser } from './converters/pdf-converter.js';
    import { convertToDOCX, verifyLibreOffice } from './converters/docx-converter.js';
    import * as path from 'path';

    const program = new Command();

    program
      .name('html-doc-converter')
      .description('Convert HTML documents to PDF and DOCX')
      .version('1.0.0')
      .argument('<input>', 'Input HTML file path')
      .option('-o, --output <path>', 'Output file path (without extension)')
      .option('-f, --format <format>', 'Output format: pdf, docx, or both', 'both')
      .option('--pdf-only', 'Generate PDF only')
      .option('--docx-only', 'Generate DOCX only')
      .action(async (input, options) => {
        // Implementation in Task 2
      });

    program.parse();
    ```

    Add shebang line for direct execution.
    Use ES module imports with .js extensions.
  </action>
  <verify>node dist/cli.js --help shows usage</verify>
  <done>CLI parses arguments correctly; help text displays</done>
</task>

<task type="auto">
  <name>Task 2: Implement conversion action</name>
  <files>src/cli.ts</files>
  <action>
    Implement the action handler:

    ```typescript
    .action(async (input: string, options: {
      output?: string;
      format?: string;
      pdfOnly?: boolean;
      docxOnly?: boolean;
    }) => {
      try {
        // Validate input file exists
        const inputPath = path.resolve(input);
        // fs.access check...

        // Determine output base path
        const outputBase = options.output
          ? path.resolve(options.output)
          : inputPath.replace(/\.[^.]+$/, '');

        // Determine formats
        let generatePDF = true;
        let generateDOCX = true;

        if (options.pdfOnly) {
          generateDOCX = false;
        } else if (options.docxOnly) {
          generatePDF = false;
        } else if (options.format) {
          generatePDF = options.format === 'pdf' || options.format === 'both';
          generateDOCX = options.format === 'docx' || options.format === 'both';
        }

        // Check LibreOffice if DOCX needed
        if (generateDOCX) {
          const hasLO = await verifyLibreOffice();
          if (!hasLO) {
            console.error('Error: LibreOffice not found. Install it for DOCX conversion.');
            console.error('       Or use --pdf-only to generate PDF only.');
            process.exit(1);
          }
        }

        // Convert
        console.log(`Converting: ${inputPath}`);

        if (generatePDF) {
          const pdfPath = `${outputBase}.pdf`;
          console.log(`  → PDF: ${pdfPath}`);
          await convertToPDF(inputPath, pdfPath);
          console.log('    ✓ PDF created');
        }

        if (generateDOCX) {
          const docxPath = `${outputBase}.docx`;
          console.log(`  → DOCX: ${docxPath}`);
          const result = await convertToDOCX(inputPath, docxPath);
          if (result.success) {
            console.log('    ✓ DOCX created');
          } else {
            console.error(`    ✗ DOCX failed: ${result.error}`);
          }
        }

        console.log('Done!');

      } catch (error) {
        console.error('Error:', error instanceof Error ? error.message : error);
        process.exit(1);
      } finally {
        await closeBrowser();
      }
    });
    ```

    Key points:
    - Validate input exists before processing
    - Check LibreOffice before attempting DOCX
    - Clean up browser on exit
    - Clear progress messages
  </action>
  <verify>Convert SRS document via CLI: node dist/cli.js /path/to/SRS.html</verify>
  <done>CLI converts files successfully with progress output</done>
</task>

<task type="auto">
  <name>Task 3: Add input validation and error handling</name>
  <files>src/cli.ts</files>
  <action>
    Add robust validation:

    ```typescript
    import * as fs from 'fs/promises';

    // At start of action handler:
    // 1. Check input file exists
    try {
      await fs.access(inputPath);
    } catch {
      console.error(`Error: Input file not found: ${inputPath}`);
      process.exit(1);
    }

    // 2. Check it's an HTML file
    const ext = path.extname(inputPath).toLowerCase();
    if (ext !== '.html' && ext !== '.htm') {
      console.error(`Error: Input must be an HTML file (got ${ext})`);
      process.exit(1);
    }

    // 3. Check output directory is writable
    const outputDir = path.dirname(outputBase);
    try {
      await fs.access(outputDir, fs.constants.W_OK);
    } catch {
      // Try to create it
      await fs.mkdir(outputDir, { recursive: true });
    }
    ```

    Add examples to help text:
    ```typescript
    program
      .addHelpText('after', `
    Examples:
      $ html-doc-converter document.html
      $ html-doc-converter document.html -o output/report
      $ html-doc-converter document.html --pdf-only
      $ html-doc-converter document.html -f docx
    `);
    ```
  </action>
  <verify>CLI shows helpful errors for missing files, wrong extensions</verify>
  <done>Input validation complete; helpful error messages</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` compiles without errors
- [ ] `node dist/cli.js --help` shows usage and examples
- [ ] Convert SRS document: `node dist/cli.js /path/to/SRS.html`
- [ ] Both PDF and DOCX generated by default
- [ ] `--pdf-only` works
- [ ] `--docx-only` works
- [ ] Clear error for missing input file
- [ ] Clear error for missing LibreOffice (when DOCX requested)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- CLI is user-friendly with clear help and errors
- Ready for Phase 6 (Output Handling)
</success_criteria>

<output>
After completion, create `.planning/phases/05-cli-interface/05-01-SUMMARY.md`
</output>
