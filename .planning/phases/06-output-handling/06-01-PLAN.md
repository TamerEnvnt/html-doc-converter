---
phase: 06-output-handling
plan: 01
type: execute
---

<objective>
Manage output files, directories, and error conditions for robust file handling.

Purpose: Ensure reliable file output with proper naming, directory creation, and comprehensive error handling.
Output: Enhanced output handling with clear user feedback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Depends on:** Phase 5 (CLI Interface)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement smart output file naming</name>
  <files>src/utils/output-handler.ts</files>
  <action>
    Create output handler utility:

    ```typescript
    interface OutputPaths {
      pdf: string;
      docx: string;
      baseName: string;
      outputDir: string;
    }

    function resolveOutputPaths(
      inputPath: string,
      outputOption?: string
    ): OutputPaths {
      // If output specified: use as base
      // If not: use input filename in same directory
      // Handle: absolute paths, relative paths, with/without extension
    }

    async function ensureOutputDirectory(dirPath: string): Promise<void> {
      // Create directory recursively if needed
    }

    function generateUniqueFilename(basePath: string, ext: string): string {
      // If file exists, add -1, -2, etc. to avoid overwrite
      // Or optionally: ask user / force overwrite flag
    }
    ```

    Export utilities for use in CLI and converters.
  </action>
  <verify>Output paths resolve correctly for various input combinations</verify>
  <done>Smart naming handles all path scenarios</done>
</task>

<task type="auto">
  <name>Task 2: Implement comprehensive error handling</name>
  <files>src/utils/errors.ts, src/cli.ts</files>
  <action>
    Create custom error types:

    ```typescript
    // src/utils/errors.ts
    export class ConversionError extends Error {
      constructor(
        message: string,
        public readonly code: string,
        public readonly suggestion?: string
      ) {
        super(message);
        this.name = 'ConversionError';
      }
    }

    export const ErrorCodes = {
      INPUT_NOT_FOUND: 'INPUT_NOT_FOUND',
      INVALID_FORMAT: 'INVALID_FORMAT',
      LIBREOFFICE_MISSING: 'LIBREOFFICE_MISSING',
      OUTPUT_DIR_FAILED: 'OUTPUT_DIR_FAILED',
      PDF_FAILED: 'PDF_FAILED',
      DOCX_FAILED: 'DOCX_FAILED',
    } as const;

    export function formatError(error: ConversionError): string {
      let msg = `Error: ${error.message}`;
      if (error.suggestion) {
        msg += `\n  Suggestion: ${error.suggestion}`;
      }
      return msg;
    }
    ```

    Update CLI to use structured errors with helpful suggestions.
  </action>
  <verify>Errors display with clear messages and suggestions</verify>
  <done>Error handling provides actionable feedback</done>
</task>

<task type="auto">
  <name>Task 3: Add progress feedback and summary</name>
  <files>src/cli.ts</files>
  <action>
    Enhance CLI output:

    ```typescript
    // Progress indicator
    console.log('Converting HTML to documents...');
    console.log(`  Input: ${inputPath}`);
    console.log('');

    // Per-format progress
    if (generatePDF) {
      process.stdout.write('  [PDF] Generating...');
      await convertToPDF(inputPath, pdfPath);
      console.log(' ✓ Done');
      console.log(`        → ${pdfPath}`);
    }

    // Summary at end
    console.log('');
    console.log('Summary:');
    console.log(`  ✓ ${successCount} file(s) created`);
    if (errorCount > 0) {
      console.log(`  ✗ ${errorCount} error(s)`);
    }
    ```

    Keep output clean and scannable.
  </action>
  <verify>CLI shows clear progress during conversion</verify>
  <done>User sees progress and final summary</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Output directory created automatically if missing
- [ ] Filenames resolve correctly for all path combinations
- [ ] Errors show clear messages with suggestions
- [ ] Progress visible during conversion
- [ ] Summary shows what was created
</verification>

<success_criteria>

- All tasks completed
- Robust file handling for edge cases
- User-friendly feedback throughout
</success_criteria>

<output>
After completion, create `.planning/phases/06-output-handling/06-01-SUMMARY.md`
</output>
