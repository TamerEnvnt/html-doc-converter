---
phase: 36-verification
plan: 01
type: execute
---

<objective>
Final milestone verification: run full test suite with coverage, TypeScript check, and audit all review findings against actual implementations.

Purpose: Confirm every finding from the 5-agent review (2026-02-19) has been addressed before closing milestone v1.4.
Output: Verification report in SUMMARY.md with coverage metrics, finding audit, and milestone readiness assessment.
</objective>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
</context>

<tasks>
<task type="auto">
  <name>Task 1: Run full test suite with coverage and TypeScript check</name>
  <files>None (read-only verification)</files>
  <action>
  Run the full verification suite and capture results:

  1. **TypeScript check:** `npx tsc --noEmit` — must produce 0 errors.

  2. **Test suite with coverage:** `npx vitest run --coverage` — capture:
     - Total tests, passed, failed, skipped
     - Statement, branch, function, line coverage percentages
     - Any test failures (investigate if found)

  3. **Collect baseline comparison** from STATE.md shipped milestones table:
     - v1.3: 194 tests, 82.2% stmts, 86.46% branches, 95.45% funcs
     - v1.4 target: 211+ tests (17 added in Phase 35), coverage should be >= v1.3

  Do NOT modify any code. This is a read-only audit. If tests fail, document the failures — do not fix them (that would indicate Phase 35 was incomplete).
  </action>
  <verify>TypeScript: 0 errors. Tests: 0 failures (skipped tests are acceptable). Coverage: >= 82% stmts.</verify>
  <done>Full test and coverage results captured. TypeScript clean. No regressions.</done>
</task>

<task type="auto">
  <name>Task 2: Audit all review findings against implementations</name>
  <files>None (read-only verification)</files>
  <action>
  Verify each finding from the 5-agent review is addressed by reading source code. For each finding, confirm the fix exists in the codebase (grep/read the relevant file and line).

  **Phase 29 — Critical Fixes (3 findings):**
  1. P1: Signal handler hang — Check `src/cli.ts` for re-entrance guard (`shuttingDown` flag) and force-exit timeout (`setTimeout` with `process.exit(1)`)
  2. P1: Browser launch timeout — Check `src/converters/pdf-converter.ts` for `timeout` option in `puppeteer.launch()` call (should be `BROWSER_LAUNCH_TIMEOUT_MS`)
  3. P1: DOCX timeout `||` vs `??` — Check `src/converters/docx-converter.ts` for `??` operator (not `||`) on timeout option

  **Phase 30 — Error Message Quality (3 findings, 1 cross-ref):**
  4. P1: Browser launch error message — Cross-ref to Phase 29. Check pdf-converter.ts has specific error wrapping for browser launch failures
  5. P1: html-parser throws plain Error — Check `src/parsers/html-parser.ts` `loadHTML()` for `createError(ErrorCodes.INPUT_NOT_FOUND, ...)` instead of `new Error()`
  6. P2: Silent cleanup catch blocks — Check `src/converters/pdf-converter.ts` `closeBrowser()` and page.close catch blocks for `verbose()` logging

  **Phase 31 — Process Lifecycle (2 findings):**
  7. P2: process.exit() placement — Check `src/cli.ts` for `exitCode` variable pattern with `process.exit()` in finally block
  8. P2: unhandledRejection handler — Check `src/cli.ts` for `process.on('unhandledRejection', ...)` handler

  **Phase 32 — Silent Failure Elimination (5 findings):**
  9. P1: which/where catch-all — Check `src/utils/soffice.ts` for error code discrimination in catch blocks (not catching ALL as "not found")
  10. P1: Chromium detection catch-all — Check `src/utils/dependencies.ts` for verbose logging in chromium catch blocks
  11. P2: fs.access EACCES — Check `src/converters/docx-converter.ts` for EACCES/EPERM distinction in fs.access catch
  12. P2: Platform fallback visibility — Check `src/utils/platform.ts` for `console.warn()` (not just `verbose()`) on unknown platform
  13. P2: LibreOffice version regex — Check `src/utils/dependencies.ts` for regex with optional 4th segment (`(?:\.\d+)?`)

  **Phase 33 — API & Performance (4 findings):**
  14. P2: getBrowser in public API — Check `src/index.ts` does NOT export `getBrowser`
  15. P2: Timeout magic numbers — Check `src/utils/constants.ts` exists with `DEFAULT_TIMEOUT_MS` and `BROWSER_LAUNCH_TIMEOUT_MS`. Grep for remaining `60000` or `30000` literals in src/ (should only appear in constants.ts)
  16. P2: O(n^2) string concat — Check `src/parsers/html-parser.ts` for array-join pattern (`.push()` + `.join('')`) instead of `content +=`
  17. P3: Scale NaN validation — Check `src/converters/pdf-converter.ts` for `isNaN(options.scale)` guard

  **Phase 34 — Type Safety (4 findings):**
  18. P2: Missing readonly on html-parser types — Check `src/parsers/html-parser.ts` for `readonly` on Chapter (5), DocumentMetadata (4), ParsedDocument (4) — all 13 fields
  19. P2: DependencyCheckResult.allFound — Check `src/utils/dependencies.ts` for JSDoc on `allFound` field
  20. P2: Anonymous validateInputFile return type — Check `src/cli-helpers.ts` for named `ValidatedInput` interface
  21. P2: CLIOptions.format unconstrained — Check `src/cli.ts` for `OutputFormat = 'pdf' | 'docx' | 'both'` type

  **Phase 35 — Test Coverage (5 findings):**
  22. P2: No --docx-only CLI test — Check `tests/cli.test.ts` for `--docx-only` or `docx-only` test
  23. P2: No partial failure exit code 2 test — Check `tests/cli.test.ts` for exit code 2 test
  24. P2: No mocked version extraction tests — Check `tests/utils/dependencies-mocked.test.ts` exists with checkChromium/checkLibreOffice tests
  25. P2: isHeadingLevel not tested — Check `tests/html-parser.test.ts` for `isHeadingLevel` tests
  26. P3: DOCX outputDir not tested — Check `tests/docx-converter-mocked.test.ts` for outputDir test

  **Audit format:** For each finding, record: PASS (fix confirmed in code) or FAIL (fix missing or incomplete). If any FAIL, document exactly what's missing.

  **Final tally:** Count P1, P2, P3 findings addressed. Compare against review source (Code Review: 2P1+4P2+3P3, Silent Failure Hunter: 5HIGH+7MED+2LOW, Architecture, Type Design, Test Coverage).
  </action>
  <verify>All 26 findings show PASS status. No FAIL findings.</verify>
  <done>Complete audit table with PASS/FAIL for each finding. Final tally matches or exceeds milestone target. Milestone v1.4 readiness confirmed.</done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` — 0 errors
- [ ] `npx vitest run` — 0 failures
- [ ] Coverage >= 82% statements
- [ ] All 26 findings audited with PASS/FAIL
- [ ] No FAIL findings in audit
</verification>

<success_criteria>
- TypeScript compiles cleanly
- All tests pass (skipped acceptable)
- Coverage at or above v1.3 baseline
- Every review finding confirmed addressed in code
- Milestone v1.4 ready for completion
</success_criteria>

<output>
After completion, create `.planning/phases/36-verification/36-01-SUMMARY.md` with:
- Test results table (total, passed, failed, skipped)
- Coverage comparison table (v1.3 vs v1.4)
- Full findings audit table (26 rows, each PASS/FAIL with evidence)
- Milestone readiness assessment
</output>
