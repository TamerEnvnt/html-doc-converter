---
phase: 10-polish
plan: 01
type: execute
---

<objective>
Refinement, edge case handling, and improved error messages for production readiness.

Purpose: Make the tool robust and pleasant to use in real-world scenarios.
Output: Polished tool ready for release.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Depends on:** Phase 9 (Documentation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Improve error messages throughout</name>
  <files>src/utils/errors.ts, src/cli.ts, src/converters/*.ts</files>
  <action>
    Review and enhance all error messages:

    1. Audit existing error handling:
       - Input file errors
       - Permission errors
       - Conversion failures
       - Missing dependencies

    2. Ensure each error has:
       - Clear description of what went wrong
       - Context (which file, which step)
       - Actionable suggestion when possible

    3. Add color to CLI output (optional, but nice):
       ```typescript
       const colors = {
         red: (s: string) => `\x1b[31m${s}\x1b[0m`,
         green: (s: string) => `\x1b[32m${s}\x1b[0m`,
         yellow: (s: string) => `\x1b[33m${s}\x1b[0m`,
         dim: (s: string) => `\x1b[2m${s}\x1b[0m`,
       };

       console.log(colors.green('✓'), 'PDF created');
       console.error(colors.red('✗'), 'Error:', message);
       ```

    4. Test error scenarios:
       - Missing input file
       - Invalid HTML (malformed)
       - Output directory not writable
       - LibreOffice timeout
  </action>
  <verify>All error scenarios show helpful messages</verify>
  <done>Error messages are clear and actionable</done>
</task>

<task type="auto">
  <name>Task 2: Handle edge cases</name>
  <files>src/converters/*.ts, src/parsers/html-parser.ts</files>
  <action>
    Address known edge cases:

    1. **Large files**: Add progress indicator for long conversions
       ```typescript
       if (fileSize > 1_000_000) {
         console.log('  Large file detected, this may take a moment...');
       }
       ```

    2. **Empty HTML**: Handle gracefully
       ```typescript
       if (!html.trim()) {
         throw new ConversionError('Input HTML is empty', 'EMPTY_INPUT');
       }
       ```

    3. **Relative paths in HTML**: Handle base URL for assets
       ```typescript
       // Set base URL so relative paths resolve
       await page.goto(`file://${absolutePath}`, {
         waitUntil: 'networkidle0'
       });
       ```

    4. **Special characters in filenames**: Handle spaces, unicode
       ```typescript
       // Already quoted in commands, but verify
       ```

    5. **Concurrent conversions**: Document that browser is shared
       ```typescript
       // Note: Browser instance is shared for performance
       // For true parallel conversions, use separate processes
       ```

    6. **Timeout handling**: Add configurable timeout
       ```typescript
       const timeout = options.timeout || 30000;
       await page.pdf({ ...options, timeout });
       ```
  </action>
  <verify>Edge cases handled without crashes</verify>
  <done>Tool handles edge cases gracefully</done>
</task>

<task type="auto">
  <name>Task 3: Add logging option and final cleanup</name>
  <files>src/cli.ts, src/utils/logger.ts</files>
  <action>
    1. Add verbose logging option:
       ```typescript
       program.option('-v, --verbose', 'Show detailed output');

       // In action handler:
       if (options.verbose) {
         console.log('  Loading HTML...');
         console.log('  Launching browser...');
         console.log('  Generating PDF...');
       }
       ```

    2. Create simple logger utility:
       ```typescript
       // src/utils/logger.ts
       let verbose = false;

       export function setVerbose(v: boolean) {
         verbose = v;
       }

       export function log(...args: unknown[]) {
         if (verbose) {
           console.log(...args);
         }
       }

       export function info(...args: unknown[]) {
         console.log(...args);
       }

       export function error(...args: unknown[]) {
         console.error(...args);
       }
       ```

    3. Final cleanup:
       - Remove any TODO comments
       - Ensure all console.log uses logger
       - Verify all exports are intentional
       - Run full test suite

    4. Update package.json for publishing:
       ```json
       {
         "files": ["dist"],
         "keywords": ["html", "pdf", "docx", "converter", "document"],
         "repository": { ... },
         "bugs": { ... }
       }
       ```
  </action>
  <verify>Verbose mode works; package.json ready for npm publish</verify>
  <done>Tool is polished and ready for release</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All error messages are helpful
- [ ] Edge cases don't crash the tool
- [ ] Verbose mode provides useful debug info
- [ ] No TODOs or debug code left
- [ ] Full test suite passes
- [ ] package.json ready for publishing
</verification>

<success_criteria>

- All tasks completed
- Tool is production-ready
- Pleasant user experience
- Ready for npm publish
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish/10-01-SUMMARY.md`
</output>
